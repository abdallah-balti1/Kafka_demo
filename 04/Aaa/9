Si Windows aussi affiche la m√™me alerte, alors ce n‚Äôest pas un bug ‚ÄúExcel Mac‚Äù, c‚Äôest quasiment toujours un de ces 2 cas :

1. Tes cellules ‚ÄúNew ADL in/out‚Äù n‚Äôexistent pas r√©ellement dans le fichier (elles sont ‚Äúvides‚Äù ‚Üí Excel n‚Äôa pas d‚Äôobjet cellule avec locked=False, donc il consid√®re la zone comme verrouill√©e).
üëâ √áa arrive tr√®s souvent si tu utilises ws.append([... None, None ...]) ou si tu laisses des None : openpyxl n‚Äô√©crit pas forc√©ment les cellules vides, donc elles restent ‚Äúpar d√©faut‚Äù = locked.


2. Tu appliques un style / NamedStyle apr√®s avoir mis locked=False, et √ßa remet locked=True.



‚úÖ La solution la plus fiable : forcer la cr√©ation + d√©verrouillage de la plage L4:M(last_row) juste avant de prot√©ger la feuille.

Voici une fonction compl√®te ‚Äúclean‚Äù qui fait exactement √ßa (et √©vite le pi√®ge des cellules None) :

import openpyxl
from openpyxl.styles import PatternFill, Font, Alignment, Protection, Border, Side
from openpyxl.utils import get_column_letter


def create_specific_fees_template_workbook(adl_fees_data: list[dict]) -> openpyxl.Workbook:
    FONT_NAME = "Calibri"

    black_fill = PatternFill(fill_type="solid", fgColor="000000")
    dark_fill = PatternFill(fill_type="solid", fgColor="1F1F1F")
    editable_fill = PatternFill(fill_type="solid", fgColor="E6E6E6")

    font_white_bold = Font(name=FONT_NAME, size=11, bold=True, color="FFFFFF")
    font_black = Font(name=FONT_NAME, size=11, color="000000")

    align_center = Alignment(horizontal="center", vertical="center", wrap_text=True)
    align_left = Alignment(horizontal="left", vertical="center", wrap_text=True)

    thin = Side(style="thin", color="BFBFBF")
    border = Border(left=thin, right=thin, top=thin, bottom=thin)

    COL_NEW_IN = 12  # L
    COL_NEW_OUT = 13  # M

    wb = openpyxl.Workbook()
    ws = wb.active
    ws.title = "Specific Fees"

    # -------- Title row (1)
    ws.merge_cells(start_row=1, start_column=1, end_row=1, end_column=14)
    c = ws.cell(row=1, column=1, value="BNP PARIBAS EASY - Update of real ADL fees (in bps)")
    c.fill = black_fill
    c.font = font_white_bold
    c.alignment = align_left
    c.border = border
    c.protection = Protection(locked=True)
    ws.row_dimensions[1].height = 24

    # -------- Group header (2)
    groups = [
        (1, 7, "Product / Share"),
        (8, 9, "Current ADL fees"),
        (10, 11, "Maximum ADL fees"),
        (12, 13, "New ADL fees (editable)"),
        (14, 14, "Effective NAV date"),
    ]
    for start_col, end_col, label in groups:
        ws.merge_cells(start_row=2, start_column=start_col, end_row=2, end_column=end_col)
        cell = ws.cell(row=2, column=start_col, value=label)
        cell.fill = black_fill
        cell.font = font_white_bold
        cell.alignment = align_center
        for col in range(start_col, end_col + 1):
            cc = ws.cell(row=2, column=col)
            cc.border = border
            cc.protection = Protection(locked=True)
    ws.row_dimensions[2].height = 20

    # -------- Column titles (3)
    headers = [
        "Umbrella name",
        "Sub-fund name",
        "Sub-fund ALADDIN code",
        "Sub-fund status",
        "Share name",
        "ISIN code",
        "Share status",
        "ADL in",
        "ADL out",
        "Max ADL in",
        "Max ADL out",
        "New ADL in",
        "New ADL out",
        "Effective NAV date",
    ]
    for col_idx, h in enumerate(headers, start=1):
        cell = ws.cell(row=3, column=col_idx, value=h)
        cell.fill = dark_fill
        cell.font = font_white_bold
        cell.alignment = align_center
        cell.border = border
        cell.protection = Protection(locked=True)
    ws.row_dimensions[3].height = 34

    ws.freeze_panes = "A4"

    # -------- Column widths
    col_widths = {
        1: 22, 2: 34, 3: 22, 4: 16,
        5: 55, 6: 18, 7: 16,
        8: 10, 9: 10, 10: 12, 11: 12,
        12: 12, 13: 12, 14: 18
    }
    for col_idx, w in col_widths.items():
        ws.column_dimensions[get_column_letter(col_idx)].width = w

    # -------- Data rows
    start_row = 4
    for i, row in enumerate(adl_fees_data):
        r = start_row + i

        # Tu peux laisser None, on va forcer la cr√©ation des cellules L/M ensuite de fa√ßon s√ªre
        values = [
            row.get("umb_name_lbl"),
            row.get("sbf_name"),
            row.get("prod_cd_valu"),
            row.get("sbf_stat_lbl"),
            row.get("sha_name"),
            row.get("isin_cd"),
            row.get("sha_stat_lbl"),
            row.get("adl_in_fee"),
            row.get("adl_out_fee"),
            row.get("max_adl_in_fee"),
            row.get("max_adl_out_fee"),
            row.get("adl_in_fee"),    # pr√©-rempli (optionnel)
            row.get("adl_out_fee"),   # pr√©-rempli (optionnel)
            row.get("nav_valuation_date"),
        ]

        for col_idx, v in enumerate(values, start=1):
            cell = ws.cell(row=r, column=col_idx, value=v)

            # style d'abord
            cell.font = font_black
            cell.border = border
            cell.alignment = align_left if col_idx <= 7 else align_center

            # protection par d√©faut (on corrigera L/M juste apr√®s, de fa√ßon s√ªre)
            cell.protection = Protection(locked=True)

    last_row = max(start_row, start_row + len(adl_fees_data) - 1)

    # =========================================================
    # ‚úÖ PATCH ULTRA FIABLE : forcer cr√©ation + unlock L/M
    # (m√™me si vides / None / non √©crites par openpyxl)
    # =========================================================
    for r in range(start_row, last_row + 1):
        for col in (COL_NEW_IN, COL_NEW_OUT):
            cell = ws.cell(row=r, column=col)  # force la cr√©ation
            # style (gris)
            cell.fill = editable_fill
            cell.font = font_black
            cell.border = border
            cell.alignment = align_center
            # UNLOCK EN DERNIER
            cell.protection = Protection(locked=False)

    # -------- Protect sheet (TOUT √Ä LA FIN)
    ws.protection.sheet = True
    ws.protection.enable()

    # Je te conseille de laisser les 2 √† True (sinon Excel est parfois ‚Äúbizarre‚Äù)
    ws.protection.selectLockedCells = True
    ws.protection.selectUnlockedCells = True

    return wb

Pourquoi cette version marche ‚Äú√† coup s√ªr‚Äù

M√™me si les cellules L/M √©taient None ‚Üí elles sont cr√©√©es explicitement.

Le locked=False est appliqu√© apr√®s tout style, donc il n‚Äôest plus √©cras√©.

Protection feuille activ√©e apr√®s avoir pr√©par√© les cellules.



---

Si apr√®s √ßa tu as encore l‚Äôalerte, envoie-moi juste :

le bout de code exact o√π tu sauves le fichier (wb.save(...) ou BytesIO),

et si tu utilises write_only=True / Workbook(write_only=True) quelque part (√ßa change tout).
