import axios from "utils/customizedAxios";
import { User } from "schemas/user";
import { Poc } from "schemas/pocs";

export const assignUserToPoc = async (
  user: User,
  poc: Poc,
  startUsing: string,
  endUsing: string
): Promise<void> => {
  try {
    const response = await axios.get(`/manage/pocs/user/${user.userId}`);

    const payload = {
      user: { userId: user.userId },
      poc: { id: poc.id },
      startUsing,
      endUsing,
    };

    if (response.data && response.data.poc) {
      // Update existing relation
      await axios.put("/manage/user/poc", payload);
    } else {
      // Create new relation
      await axios.post("/manage/user/poc", payload);
    }
  } catch (error: any) {
    if (error.response && error.response.status === 404) {
      // No relation exists, create one
      const payload = {
        user: { userId: user.userId },
        poc: { id: poc.id },
        startUsing,
        endUsing,
      };
      await axios.post("/manage/user/poc", payload);
    } else {
      throw error;
    }
  }
};
