from openpyxl.worksheet.datavalidation import DataValidation
from openpyxl.utils import get_column_letter

def create_data_validation(ws, adl_fees_data):
    """Add numeric >= 0 validation to editable ADL columns."""

    end_row = DATA_START_ROW + max(len(adl_fees_data), 1) - 1

    anchor_col = get_column_letter(NEW_ADL_IN_COLUMN)
    anchor = f"{anchor_col}{DATA_START_ROW}"

    formula = (
        f'OR({anchor}="";'
        f'IFERROR(VALUE(SUBSTITUTE({anchor},".",","))>=0;FALSE))'
    )

    dv = DataValidation(
        type="custom",
        formula1=formula,
        allow_blank=True,
        showErrorMessage=True,
        errorTitle=DATA_VALIDATION_ERROR_TITLE,
        error=DATA_VALIDATION_ERROR_MESSAGE,
    )

    col_in = get_column_letter(NEW_ADL_IN_COLUMN)
    col_out = get_column_letter(NEW_ADL_OUT_COLUMN)

    ws.add_data_validation(dv)
    dv.add(f"{col_in}{DATA_START_ROW}:{col_out}{end_row}")
